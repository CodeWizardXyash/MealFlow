// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  recipes       Recipe[]
  weeklyPlans   WeeklyPlan[]
  favorites     Favorite[]
  role          Role     @default(USER)

  @@index([email])
}

enum Role {
  USER
  ADMIN
}

model Recipe {
  id           Int      @id @default(autoincrement())
  title        String
  description  String?
  instructions String[]
  tags         String[]
  rating       Float?   @default(0)
  imageUrl     String?
  prepTime     Int?     // in minutes
  cookTime     Int?     // in minutes
  servings     Int?     @default(1)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  userId       Int

  user              User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  recipeIngredients RecipeIngredient[]
  plannerEntries    PlannerEntry[]
  favorites         Favorite[]

  @@index([userId])
  @@index([tags])
  @@index([rating])
}

model Ingredient {
  id       Int    @id @default(autoincrement())
  name     String @unique
  category String // e.g., "Dairy", "Vegetables", "Meat", "Grains"
  unit     String // e.g., "cups", "grams", "pieces"

  recipeIngredients RecipeIngredient[]

  @@index([category])
}

model RecipeIngredient {
  id           Int   @id @default(autoincrement())
  recipeId     Int
  ingredientId Int
  quantity     Float

  recipe     Recipe     @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  ingredient Ingredient @relation(fields: [ingredientId], references: [id], onDelete: Cascade)

  @@unique([recipeId, ingredientId])
  @@index([recipeId])
  @@index([ingredientId])
}

model WeeklyPlan {
  id        Int      @id @default(autoincrement())
  userId    Int
  weekStart DateTime // Start of the week (Monday)
  weekEnd   DateTime // End of the week (Sunday)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user           User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  plannerEntries PlannerEntry[]

  @@unique([userId, weekStart])
  @@index([userId])
  @@index([weekStart])
}

model PlannerEntry {
  id           Int      @id @default(autoincrement())
  weeklyPlanId Int
  recipeId     Int
  dayOfWeek    Int      // 0 = Monday, 6 = Sunday
  mealType     String   // "Breakfast", "Lunch", "Dinner", "Snack"
  createdAt    DateTime @default(now())

  weeklyPlan WeeklyPlan @relation(fields: [weeklyPlanId], references: [id], onDelete: Cascade)
  recipe     Recipe     @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@index([weeklyPlanId])
  @@index([recipeId])
}

model Favorite {
  id        Int      @id @default(autoincrement())
  userId    Int
  recipeId  Int
  createdAt DateTime @default(now())

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  recipe Recipe @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@unique([userId, recipeId])
  @@index([userId])
}
